### 각 계층과 프로토콜

![Untitled](https://user-images.githubusercontent.com/80368511/215286755-03162240-6732-4b52-b21f-0e6fe0c06392.png)
![image](https://user-images.githubusercontent.com/80368511/215286798-3575f5dc-9e85-4e37-b2eb-3d61347732c1.png)

4계층 장비

| L4 스위치 | TCP/UDP 포트번호를 분석하여 포워딩을 결정. |
| --- | --- |

3계층 장비 : 올바른 경로를 선택하도록 지원

| 라우터 | LAN연결, 패킷의 위치 추출, 그 위치에 대한 최적의 경로 지정.  |
| --- | --- |

### 라우터

라우터는 3계층(network계층) 에서 동작하는 여러 네트워크 장비의 대표격으로 경로를 지정하는 역할을 한다. 원격지 통신에서 필수적인 장비이다. 라우터는 다양한 경로를 수집 후 최적의 경로를 라우팅 테이블에 저장하며 패킷이 들어오면 도착지 IP주소를 라우팅 테이블과 비교해 최선의 패킷을 내보낸다. 

**전달 과정**

패킷이 한번에 전달되면 참 좋지만 그렇지 않고 인접한 라우터까지만 경로를 지정한 후 인접 라우터에서 최적의 경로를 다시 파악해 라우터로 패킷을 포워딩시킨다. 

Hop-by-Hop과 Next Hop

![image (1)](https://user-images.githubusercontent.com/80368511/215286824-44513a92-1de6-4c2c-890b-7a97792817e2.png)

네트워크를 한 단계씩 띄어넘는다는 의미로 홉-바이-홉 라우팅이라고 부르고, 인접한 라우터를 넥스트 홉이라고 부른다. 라우터는 패킷이 목적지로 가는 전체 경로를 파악하지 않고, 최적의 넥스트 홉을 선택해 포워딩한다. 

**라우팅 테이블**

라우터는 출발지와 상관없이 **목적지 주소와 라우팅 테이블을 비교해 포워딩 경로**를 설정한다. 또한 라우팅 테이블을 만들 때 목적지 주소만 수집하며 패킷이 들어오면 목적지 주소를 확인해 패킷을 넥스트 홉으로 포워딩시킨다. **라이팅 테이블**에 저장되는 정보는 **목적지 주소, 넥스트 홉IP주소**가 있다.

---

### 로드밸런싱 (Load Balancing)
![image (2)](https://user-images.githubusercontent.com/80368511/215286862-a6c9f677-17d6-40af-9ca5-589321abcc78.png)

여러 대의 서버를 두고 서비스를 제공하는 분산처리 시스템에서 서버에 가해지는 로드를 분산 해주는 기술이다. **로드밸런싱을 통해 여러 대의 서버로 트래픽을 균등하게 분산시킬 수 있다**.

- L4 : 네트워크 계층이나 전송계층의 정보를 바탕으로 로드를 분산한다. **IP주소나 포트번호, MAC주소, 전송 프로토콜에 따라 트래픽을 나누는 것이 가능하다.**

**L4스위치**

사용자는 몇대의 서버가 묶여있던 그 사실을 알 필요가 없고 하나의 서비스로 바라보기 때문에 서비스에 사용될 대표 IP주소를 갖고, 각 시스템의 실제 IP로 변경해 요청을 보낸다. 

- L7 : 애플리케이션 계층에서 로드를 분산하기 때문에 HTTP헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능하다.

|  | L4 로드 밸런서 | L7 로드 밸런서 |
| --- | --- | --- |
| 계층 | Transport Layer | Application Layer |
| 특징 | TCP/UDP 포트 정보를 바탕으로 함. | TCP/UDP 정보는 물론 HTTP의 URI, FTP의 파일명, 쿠키 정보 등을 바탕으로 한다.  |
| 장점 | 데이터 안을 들여다보지 않고 패킷 레벨에서만 로드를 분산하기 때문에 속도가 빠르고 효율이 높으며 데이터의 내용을 복호화할 필요가 없기 때문에 안전하고 L7 로드 밸런서보다 가격이 저렴하다. | 상위 계층에서 로드를 분산하기 때문에 훨씬 더 섬세한 라우팅이 가능하며 캐싱 기능을 제공한다. 또한 비 정상적인 트래픽을 사전에 필터링 할 수 있어 서비스 안전성이 높다.  |
| 단점 | 패킷의 내용을 살펴볼 수 없기 때문에 섬세한 라우팅이 불가능하다. 또한 사용자의 IP가 수시로 바뀌는 경우라면(공유기를 사용할 경우) 연속적인 서비스를 제공하기 어렵다.  | 패킷의 내용을 복호화해야 하기에 더 높은 비용을 지불해야 하며 클라이언트가 로드밸런서와 인증서를 공유해야하기 때문에 공격자가 로드밸런서를 통해서 클라이언트에 데이터에 접근 할 보안상의 위험성이 존재한다.  |
